<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decode Memo - Allianza Testnet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .copy-btn-small {
            background: #374151;
            border: 1px solid #4b5563;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
            margin-left: 8px;
        }
        .copy-btn-small:hover {
            background: #4b5563;
            border-color: #60a5fa;
        }
        .copy-btn-small:active {
            background: #1f2937;
        }
        .copy-btn-large {
            background: #2563eb;
            border: 1px solid #3b82f6;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .copy-btn-large:hover {
            background: #1d4ed8;
            border-color: #2563eb;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold mb-6">üîç Decode Cross-Chain Memo</h1>
            
            <div class="bg-gray-800 p-6 rounded-lg mb-6 relative">
                <h2 class="text-xl font-semibold mb-4">UChainID: <span class="font-mono text-cyan-400" id="uchainIdValue">{{ uchain_id }}</span>
                    <button class="copy-btn-small" onclick="copyText('{{ uchain_id }}')" title="Copy UChainID">üìã Copy</button>
                </h2>
                
                {% if error %}
                <div class="bg-red-900 p-4 rounded mb-4">
                    <p class="text-red-200">‚ùå {{ error }}</p>
                </div>
                {% else %}
                
                <div class="space-y-4">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">üìã Memo Data</h3>
                        <pre class="bg-gray-900 p-4 rounded overflow-x-auto text-sm">{{ memo_json | safe }}</pre>
                    </div>
                    
                    {% if tx_hash %}
                    <div>
                        <h3 class="text-lg font-semibold mb-2">üîó Transaction Hash</h3>
                        <p class="font-mono text-cyan-400 break-all">{{ tx_hash }}
                            <button class="copy-btn-small" onclick="copyText('{{ tx_hash }}')" title="Copy Transaction Hash">üìã Copy</button>
                        </p>
                        <a href="{{ explorer_url }}" target="_blank" class="text-blue-400 hover:underline mt-2 inline-block">
                            View on Explorer <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                    {% endif %}
                    
                    {% if zk_proof %}
                    <div>
                        <h3 class="text-lg font-semibold mb-2">üîê ZK Proof</h3>
                        <div class="bg-gray-900 p-4 rounded">
                            <p><strong>Proof ID:</strong> <span class="font-mono text-sm">{{ zk_proof.proof_id }}</span>
                                <button class="copy-btn-small" onclick="copyText('{{ zk_proof.proof_id }}')" title="Copy Proof ID">üìã Copy</button>
                            </p>
                            <p><strong>State Hash:</strong> <span class="font-mono text-sm break-all">{{ zk_proof.state_hash }}</span>
                                <button class="copy-btn-small" onclick="copyText('{{ zk_proof.state_hash }}')" title="Copy State Hash">üìã Copy</button>
                            </p>
                            <p><strong>Verified:</strong> 
                                {% if zk_proof and zk_proof.verified is defined %}
                                    {% set verified_val = zk_proof.verified %}
                                    {% if verified_val == True or verified_val == 'true' or verified_val == 1 or verified_val == 'True' or verified_val == '1' or (verified_val is string and verified_val.lower() == 'true') %}
                                    <span class="text-green-400">‚úÖ Yes</span>
                                    {% else %}
                                    <span class="text-red-400">‚ùå No</span>
                                    {% endif %}
                                {% elif zk_proof and zk_proof.valid is defined and zk_proof.valid == True %}
                                    <span class="text-green-400">‚úÖ Yes</span>
                                {% else %}
                                    <span class="text-red-400">‚ùå No</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-2">üìä Transfer Details</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-400">Source Chain</p>
                                <p class="font-semibold">{{ source_chain | title }}</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Target Chain</p>
                                <p class="font-semibold">{{ target_chain | title }}</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Amount</p>
                                <p class="font-semibold">{{ amount }} {{ token }}</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Recipient</p>
                                <p class="font-mono text-sm break-all">{{ recipient }}
                                    <button class="copy-btn-small" onclick="copyText('{{ recipient }}')" title="Copy Recipient Address">üìã Copy</button>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- Bot√£o FORA da caixa para copiar tudo -->
            {% if not error %}
            <div class="text-center mb-6">
                <button class="copy-btn-large" onclick="copyAllDecoderInfo()" title="Copy All Information">
                    <i class="fas fa-copy"></i> Copy All Information
                </button>
            </div>
            {% endif %}
            
            <div class="text-center">
                <a href="/cross-chain-test" class="text-blue-400 hover:underline">
                    ‚Üê Back to Cross-Chain Test
                </a>
            </div>
        </div>
    </div>
    
    <script>
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                const event = window.event || {};
                const button = event.target || event.srcElement;
                if (button && button.classList && button.classList.contains('copy-btn-small')) {
                    const originalText = button.innerHTML;
                    button.innerHTML = '‚úÖ Copied!';
                    button.style.background = '#10b981';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.background = '';
                    }, 2000);
                }
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }
        
        function copyAllDecoderInfo() {
            const info = {
                uchain_id: '{{ uchain_id }}',
                {% if tx_hash %}
                tx_hash: '{{ tx_hash }}',
                explorer_url: '{{ explorer_url }}',
                {% endif %}
                {% if zk_proof %}
                zk_proof: {
                    proof_id: '{{ zk_proof.proof_id }}',
                    state_hash: '{{ zk_proof.state_hash }}',
                    verified: {{ zk_proof.verified|lower if zk_proof.verified is defined else 'false' }}
                },
                {% endif %}
                transfer_details: {
                    source_chain: '{{ source_chain }}',
                    target_chain: '{{ target_chain }}',
                    amount: '{{ amount }}',
                    token: '{{ token }}',
                    recipient: '{{ recipient }}'
                },
                {% if memo_json %}
                memo_data: {{ memo_json | safe }}
                {% endif %}
            };
            
            const textToCopy = JSON.stringify(info, null, 2);
            navigator.clipboard.writeText(textToCopy).then(() => {
                const button = document.querySelector('.copy-btn-large');
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check"></i> All Information Copied!';
                    button.style.background = '#10b981';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.background = '';
                    }, 2000);
                }
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }
    </script>
</body>
</html>
